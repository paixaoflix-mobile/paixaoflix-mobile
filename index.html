<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PaixãoFlix TV — v3.7.0</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@clappr/player@latest/dist/clappr.min.js"></script>
    <style>
        :root { --primary: #e50914; --bg: #000; --match: #46d369; }
        * { box-sizing: border-box; font-family: 'Poppins', sans-serif; outline: none; }
        body { margin: 0; background: var(--bg); color: #fff; height: 100vh; overflow: hidden; }

        /* TELA DE CARREGAMENTO - LOGO 240PX */
        #loading-overlay { position: fixed; inset: 0; background: #000; z-index: 9999; display: flex; align-items: center; justify-content: center; flex-direction: column; }
        #loading-overlay img { width: 240px; height: auto; }

        .sidebar { width: 260px; height: 100vh; background: #000; padding: 20px; border-right: 1px solid #222; position: fixed; left: 0; top: 0; z-index: 100; }
        /* LOGO BARRA LATERAL 160PX */
        .sidebar .logo-container img { width: 160px; display: block; margin: 0 auto; }
        
        .nav-menu { flex: 1; overflow-y: auto; scrollbar-width: none; margin-top: 10px; }
        .nav-menu button { width: 100%; padding: 14px; margin-bottom: 8px; background: #222; color: #fff; border: none; box-shadow: 0 4px #000; cursor: pointer; text-align: left; display: flex; align-items: center; gap: 10px; border-radius: 4px; font-weight: 700; font-size: 16px; }
        
        /* SELETOR JUSTO */
        .focusable:focus { border: 2px solid #fff !important; background: #333 !important; outline: none; transform: scale(1.02); }

        .content-area { margin-left: 260px; height: 100vh; overflow-y: auto; padding: 30px; }
        .grid { display: grid; gap: 15px; grid-template-columns: repeat(5, 1fr); }
        
        .card { background: #141414; border-radius: 4px; overflow: hidden; border: 2px solid transparent; transition: 0.1s; cursor: pointer; }
        .card img { width: 100%; aspect-ratio: 2/3; object-fit: cover; display: block; }
        .card-info { padding: 8px; text-align: center; }
        .card-title { font-size: 12px; font-weight: bold; line-height: 1.2; display: block; min-height: 32px; word-wrap: break-word; }
        .card-meta { display: flex; justify-content: center; gap: 8px; font-size: 10px; color: var(--match); font-weight: bold; }

        #details-screen { position: fixed; inset: 0; background: #000; z-index: 500; display: none; padding: 40px; overflow-y: auto; }
        .det-wrapper { display: grid; grid-template-columns: 320px 1fr; gap: 40px; }
        
        #player-overlay { position: fixed; inset: 0; background: #000; z-index: 1000; display: none; }
        #resume-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 2000; display: none; align-items: center; justify-content: center; }

        /* MOBILE: CAPAS EM 30% DA LARGURA */
        @media (max-width: 768px) {
            .sidebar { width: 100%; height: auto; position: relative; }
            .content-area { margin-left: 0; padding: 10px; }
            .grid { 
                display: flex !important; 
                flex-wrap: wrap !important; 
                gap: 10px !important; 
                justify-content: space-between !important; 
            }
            .grid .card { 
                width: 30% !important; 
                flex: none !important; 
            }
            /* INDICAÇÕES MOBILE 30% */
            #suggest-grid { display: flex !important; overflow-x: auto; gap: 10px; }
            #suggest-grid .card { min-width: 30% !important; }
        }
    </style>
</head>
<body>

<div id="loading-overlay">
    <img src="https://raw.githubusercontent.com/paixaoflix-mobile/paixaoflix-mobile/refs/heads/main/logoof512.png">
</div>

<div id="resume-modal">
    <div style="background:#111; padding:40px; border:3px solid var(--primary); border-radius:10px; text-align:center">
        <h2>Retomar de onde parou?</h2>
        <div style="display:flex; gap:20px; margin-top:30px; justify-content:center">
            <button id="res-yes" class="focusable" style="padding:15px 40px; font-size:18px; background:#333; color:#fff; border:none; border-radius:5px">RETOMAR</button>
            <button id="res-no" class="focusable" style="padding:15px 40px; font-size:18px; background:var(--primary); color:#fff; border:none; border-radius:5px">REINICIAR</button>
        </div>
    </div>
</div>

<aside class="sidebar">
    <div class="logo-container"><img src="https://raw.githubusercontent.com/paixaoflix-mobile/paixaoflix-mobile/refs/heads/main/logoof512.png"></div>
    <div style="text-align:center; font-size:12px; margin:10px 0;">Sábado, 24 de Janeiro de 2026</div>
    <div id="counter" style="text-align:center; font-size:11px; color:#ffc107; font-weight:bold"></div>
    <div class="search-box">
        <input type="text" id="search" placeholder="Pesquisar..." class="focusable" style="width:100%; padding:10px; background:#111; color:#fff; border:1px solid #333; margin:10px 0">
    </div>
    <nav class="nav-menu">
        <button id="btn-tv" onclick="loadM3U('canais.m3u')" class="focusable"><i class="fa-solid fa-play"></i> TV AO VIVO</button>
        <button onclick="loadVOD('filmes.json', 'vod')" class="focusable"><i class="fa-solid fa-film"></i> FILMES</button>
        <button onclick="loadVOD('series.json', 'series')" class="focusable"><i class="fa-solid fa-tv"></i> SÉRIES</button>
        <button onclick="showContinue()" class="focusable" style="background:#1a1a1a"><i class="fa-solid fa-history"></i> CONTINUAR</button>
    </nav>
</aside>

<main class="content-area">
    <div class="grid" id="main-grid"></div>
</main>

<div id="details-screen">
    <div class="det-wrapper">
        <div style="text-align:center">
            <img id="det-poster" style="width:100%; border-radius:8px">
            <button class="focusable" onclick="closeDetails()" style="width:100%; margin-top:20px; padding:12px; background:#333; color:#fff; border:none">VOLTAR</button>
        </div>
        <div>
            <h1 id="det-title" style="margin:0"></h1>
            <p id="det-desc" style="color:#ccc; margin:20px 0; font-size:14px"></p>
            <div id="ep-container" style="display:flex; flex-wrap:wrap; gap:8px"></div>
            <h3 style="margin-top:40px; color:#ffc107">INDICAÇÕES</h3>
            <div class="grid" id="suggest-grid"></div>
        </div>
    </div>
</div>

<div id="player-overlay"><div id="player-wrapper" style="width:100%; height:100%"></div></div>

<script>
    const base = "https://raw.githubusercontent.com/paixaoflix-mobile/paixaoflix-mobile/main/data/";
    let cache = { vod: [], series: [], tv: [] };
    let player, pending = null;

    window.onload = async () => {
        try {
            const [f, s, t] = await Promise.all([
                fetch(base+"filmes.json").then(r => r.json()),
                fetch(base+"series.json").then(r => r.json()),
                fetch(base+"canais.m3u").then(r => r.text())
            ]);
            cache.vod = f; cache.series = s; 
            cache.tv = parseM3U(t);
            document.getElementById('counter').textContent = (f.length + s.length) + " TÍTULOS DISPONÍVEIS";
            
            setTimeout(() => {
                document.getElementById('loading-overlay').style.display = 'none';
                document.getElementById('btn-tv').focus();
            }, 1000);
        } catch(e) { console.error("Erro no carregamento"); }
        setupRemote();
    };

    function parseM3U(data) {
        const results = [];
        const lines = data.split('\n');
        for (let i = 0; i < lines.length; i++) {
            if (lines[i].includes('#EXTINF')) {
                const nome = lines[i].split(',')[1]?.trim();
                const url = lines[i+1]?.trim();
                const logo = lines[i].match(/tvg-logo="([^"]+)"/)?.[1] || '';
                if (url) results.push({ nome, url, logo, m: 'tv' });
            }
        }
        return results;
    }

    function renderItem(item, target) {
        const div = document.createElement('div');
        div.className = 'card focusable';
        div.tabIndex = 0;
        const meta = item.m !== 'tv' ? `<div class="card-meta"><span>${item.year || '2025'}</span><span>⭐ 9.5</span></div>` : '';
        div.innerHTML = `<img src="${item.poster || item.logo}"><div class="card-info"><span class="card-title">${item.titulo || item.nome}</span>${meta}</div>`;
        div.onclick = () => handleAction(item);
        target.appendChild(div);
    }

    function handleAction(item) {
        const id = item.titulo || item.nome;
        const saved = localStorage.getItem('t_' + id);
        if(saved && parseFloat(saved) > 10) {
            pending = item;
            document.getElementById('resume-modal').style.display = 'flex';
            document.getElementById('res-yes').focus();
        } else {
            openDetails(item);
        }
    }

    document.getElementById('res-yes').onclick = () => {
        document.getElementById('resume-modal').style.display = 'none';
        openDetails(pending, true);
    };

    document.getElementById('res-no').onclick = () => {
        document.getElementById('resume-modal').style.display = 'none';
        openDetails(pending, false);
    };

    function loadVOD(file, mode) {
        const g = document.getElementById('main-grid');
        g.innerHTML = '';
        cache[mode].sort((a,b) => a.titulo.localeCompare(b.titulo)).forEach(i => renderItem({...i, m:mode}, g));
        const first = g.querySelector('.focusable');
        if(first) first.focus();
    }

    function loadM3U() {
        const g = document.getElementById('main-grid');
        g.innerHTML = '';
        cache.tv.sort((a,b) => a.nome.localeCompare(b.nome)).forEach(i => renderItem(i, g));
        const first = g.querySelector('.focusable');
        if(first) first.focus();
    }

    async function openDetails(item, resume = false) {
        if(item.m === 'tv') return play(item.url, item);
        document.getElementById('details-screen').style.display = 'block';
        document.getElementById('det-title').textContent = item.titulo;
        document.getElementById('det-poster').src = item.poster;
        document.getElementById('det-desc').textContent = item.desc || "";
        
        const eps = document.getElementById('ep-container');
        eps.innerHTML = '';
        if(item.m === 'vod') {
            const b = document.createElement('button');
            b.className = 'focusable'; b.textContent = 'ASSISTIR AGORA';
            b.style = 'width:100%; padding:15px; background:var(--primary); border:none; color:#fff; font-weight:bold';
            b.onclick = () => play(item.url, item, resume);
            eps.appendChild(b);
        }
        renderSuggest();
        document.querySelector('#details-screen .focusable').focus();
    }

    function renderSuggest() {
        const s = document.getElementById('suggest-grid');
        s.innerHTML = '';
        cache.vod.sort(() => 0.5 - Math.random()).slice(0, 5).forEach(i => renderItem({...i, m:'vod'}, s));
    }

    function play(url, item, resume) {
        const id = item.titulo || item.nome;
        document.getElementById('player-overlay').style.display = 'block';
        if(player) player.destroy();
        player = new Clappr.Player({
            source: url, parentId: "#player-wrapper", width: '100%', height: '100%', autoPlay: true,
            events: {
                onReady: () => { if(resume) player.seek(parseFloat(localStorage.getItem('t_'+id))); },
                onTimeUpdate: (e) => localStorage.setItem('t_'+id, e.current)
            }
        });
    }

    function setupRemote() {
        document.addEventListener('keydown', (e) => {
            const active = document.activeElement;
            const focusables = Array.from(document.querySelectorAll('.focusable'));
            if([37,38,39,40,13].includes(e.keyCode)) e.preventDefault();
            if(e.keyCode === 13) active.click();
            if(e.keyCode === 8) { 
                if(player) { player.destroy(); document.getElementById('player-overlay').style.display='none'; }
                else closeDetails();
            }
            
            let next; const rA = active.getBoundingClientRect();
            focusables.forEach(el => {
                if(el === active || el.offsetParent === null) return;
                const rB = el.getBoundingClientRect();
                const dX = rB.left - rA.left; const dY = rB.top - rA.top;
                if(e.keyCode===40 && dY > 10 && Math.abs(dX) < 150) { if(!next || dY < (next.getBoundingClientRect().top - rA.top)) next = el; }
                if(e.keyCode===38 && dY < -10 && Math.abs(dX) < 150) { if(!next || dY > (next.getBoundingClientRect().top - rA.top)) next = el; }
                if(e.keyCode===39 && dX > 10 && Math.abs(dY) < 100) { if(!next || dX < (next.getBoundingClientRect().left - rA.left)) next = el; }
                if(e.keyCode===37 && dX < -10 && Math.abs(dY) < 100) { if(!next || dX > (next.getBoundingClientRect().left - rA.left)) next = el; }
            });
            if(next) next.focus();
        });
    }

    function closeDetails() { document.getElementById('details-screen').style.display='none'; }
    
    document.getElementById('search').oninput = (e) => {
        const v = e.target.value.toLowerCase();
        const g = document.getElementById('main-grid');
        g.innerHTML = '';
        if(!v) return;
        [...cache.vod, ...cache.series, ...cache.tv].filter(x => (x.titulo || x.nome || "").toLowerCase().includes(v)).forEach(i => renderItem(i, g));
    };
</script>
</body>
</html>
