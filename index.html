<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>PaixÃ£oFlix TV â€” v1.7.5</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<style>
@media (orientation: portrait) {
 body::before{
  content:"ðŸ”„ Gire o dispositivo para modo paisagem";
  position:fixed;inset:0;
  background:#000;color:#fff;
  display:flex;align-items:center;justify-content:center;
  font-size:22px;z-index:9999;text-align:center
 }
}

*{box-sizing:border-box}
body{
 margin:0;background:#000;color:#fff;
 font-family:'Poppins',sans-serif;
 overflow:hidden;
}
::-webkit-scrollbar{display:none}

.app{display:flex;height:100vh}

/* MENU */
.left{
 width:230px;background:#0b0b0b;
 box-shadow:2px 0 6px rgba(0,0,0,.35);
 display:flex;flex-direction:column;
 z-index: 10;
}
.logo img{
 width:clamp(100px,12vh,200px);
 margin:10px auto;display:block
}
.datetime{text-align:center;font-size:13px;opacity:.8}

/* BUSCA */
.search{padding:10px}
.search input{
 width:100%;padding:10px;
 border-radius:8px;border:none;
 background:#1a1a1a;color:#fff;
 outline: none;
}
.search input:focus {
    outline: 3px solid #e50914;
}

/* MENU BOTÃ•ES */
.menu{
 padding:10px;
 overflow-y:auto;
 flex:1
}
.menu button{
 width:100%;margin-bottom:8px;padding:12px;
 background:linear-gradient(180deg,#2a2a2a,#141414);
 border:none;border-radius:10px;color:#fff;
 cursor:pointer;
 transition: transform 0.2s;
}

/* CATEGORIAS */
.categories{
 background:#111;
 padding:8px;
 min-width:max-content;
 max-width:260px;
 overflow-y:auto
}
.cat-item{
 padding:12px 15px;
 cursor:pointer;
 white-space:nowrap;
 border-radius: 5px;
 margin-bottom: 4px;
 outline: none;
}

/* MAIN */
.main{
 flex:1;
 overflow-y:auto;
 background:radial-gradient(circle,#111,#000);
 scroll-behavior: smooth;
}

/* GRID */
.grid{
 display:grid;
 gap:16px;
 padding:16px
}
@media (max-width:1024px){
 .grid{grid-template-columns:repeat(3,1fr)}
}
@media (min-width:1025px){
 .grid{grid-template-columns:repeat(5,1fr)}
}

.card{
 background:#111;border-radius:10px;
 overflow:hidden;cursor:pointer;
 transition: transform 0.2s;
 outline: none;
}
.card img{width:100%;display:block}
.card .info{
 padding:8px;font-size:13px
}

/* FOCO GLOBAL - ESSENCIAL PARA TV */
:focus {
    outline: 4px solid #e50914 !important;
    transform: scale(1.05);
    z-index: 5;
}

.cat-item:focus {
    background: #e50914;
    border-left: none;
}

/* PLAYER */
.player-box{
 position:fixed;inset:0;
 background:#000;display:none;z-index:20
}
.player-box.active{display:block}
.video-js{width:100%;height:100%}

.exit-btn{
 position:fixed;top:15px;left:15px;
 z-index:30;background:#e50914;
 border:none;border-radius:8px;
 color:#fff;padding:10px 14px;
 display:none
}
.exit-btn.active{display:block}
</style>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
<link href="https://vjs.zencdn.net/8.10.0/video-js.css" rel="stylesheet"/>
</head>

<body>
<div class="app">

<aside class="left">
 <div class="logo">
  <img src="https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/logoof512.png">
 </div>
 <div class="datetime" id="datetime"></div>

 <div class="search">
  <input id="search" placeholder="Qual sua escolha de hoje?" tabindex="0">
 </div>

 <div class="menu">
  <button tabindex="0" onclick="tv()">ðŸ“¡ TV ao Vivo</button>
  <button tabindex="0" onclick="filmes()">ðŸŽ¬ Filmes</button>
  <button tabindex="0" onclick="series()">ðŸ“º SÃ©ries</button>
  <button tabindex="0" onclick="tvKids()">ðŸ§’ TV Kids</button>
  <button tabindex="0" onclick="filmesKids()">ðŸŽˆ Filmes Kids</button>
  <button tabindex="0" onclick="seriesKids()">ðŸ§¸ SÃ©ries Kids</button>
 </div>
</aside>

<aside class="categories" id="cats"></aside>
<main class="main" id="main"></main>

<button class="exit-btn" id="exitBtn" onclick="sair()" tabindex="0">â¬… Voltar</button>
<div class="player-box" id="playerBox">
 <video id="player" class="video-js" controls></video>
</div>

</div>

<script src="https://vjs.zencdn.net/8.10.0/video.min.js"></script>
<script>
const player=videojs("player",{fluid:true});
const box=document.getElementById("playerBox");
const exitBtn=document.getElementById("exitBtn");
const main=document.getElementById("main");
const cats=document.getElementById("cats");

/* DATA */
setInterval(()=>{
 const d=new Date();
 document.getElementById("datetime").textContent=
 d.toLocaleDateString("pt-BR",{weekday:"long"})+
 " | "+
 d.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"});
},1000);

function limpar(){cats.innerHTML="";main.innerHTML=""}

/* PLAYER */
function play(url){
 box.classList.add("active");
 exitBtn.classList.add("active");
 player.src({src:url,type:url.includes("m3u8")?"application/x-mpegURL":"video/mp4"});
 player.play();
 exitBtn.focus(); // Joga o foco no botÃ£o voltar ao dar play
}

function sair(){
 player.pause();
 box.classList.remove("active");
 exitBtn.classList.remove("active");
 // Retorna o foco para o primeiro card se houver, ou menu
 const primeiroCard = document.querySelector('.card');
 if(primeiroCard) primeiroCard.focus();
}

/* NAVEGAÃ‡ÃƒO ESPACIAL (SOLUÃ‡ÃƒO PARA TV BOX / CONTROLES) */
document.addEventListener("keydown", e => {
    const focusables = Array.from(document.querySelectorAll('button, .cat-item, .card, input, [tabindex="0"]')).filter(el => el.offsetParent !== null);
    const current = document.activeElement;

    if (e.key === "Enter") {
        return; // Deixa o clique padrÃ£o do navegador agir
    }

    if (["Escape", "Backspace"].includes(e.key)) {
        if(box.classList.contains('active')) {
            sair();
            e.preventDefault();
        }
        return;
    }

    const directions = ["ArrowUp", "ArrowDown", "ArrowLeft", "ArrowRight"];
    if (!directions.includes(e.key)) return;

    e.preventDefault();

    const currentRect = current.getBoundingClientRect();
    let next = null;
    let minDistance = Infinity;

    focusables.forEach(target => {
        if (target === current) return;
        const targetRect = target.getBoundingClientRect();

        const centerX = targetRect.left + targetRect.width / 2;
        const centerY = targetRect.top + targetRect.height / 2;
        const curCenterX = currentRect.left + currentRect.width / 2;
        const curCenterY = currentRect.top + currentRect.height / 2;

        let isDirection = false;

        // Filtro rigoroso de direÃ§Ã£o
        if (e.key === "ArrowUp" && targetRect.bottom <= (currentRect.top + 5)) isDirection = true;
        if (e.key === "ArrowDown" && targetRect.top >= (currentRect.bottom - 5)) isDirection = true;
        if (e.key === "ArrowLeft" && targetRect.right <= (currentRect.left + 5)) isDirection = true;
        if (e.key === "ArrowRight" && targetRect.left >= (currentRect.right - 5)) isDirection = true;

        if (isDirection) {
            // Peso menor para distÃ¢ncia no eixo principal para evitar saltos diagonais indesejados
            const dx = centerX - curCenterX;
            const dy = centerY - curCenterY;
            const distance = Math.sqrt(dx*dx + dy*dy);
            
            if (distance < minDistance) {
                minDistance = distance;
                next = target;
            }
        }
    });

    if (next) {
        next.focus();
        // Scroll inteligente: centraliza o item focado na tela
        next.scrollIntoView({ behavior: "smooth", block: "center", inline: "nearest" });
    }
});

/* CARREGAMENTO DE DADOS */
async function tv(){
 limpar();
 try {
    const txt=await fetch("https://raw.githubusercontent.com/paixaoflix-mobile/paixaoflix-mobile/main/data/canais.m3u").then(r=>r.text());
    const linhas=txt.split("\n");
    const grupos={};
    let atual={};

    linhas.forEach(l=>{
     if(l.startsWith("#EXTINF")){
      atual.nome=l.split(",")[1];
      atual.grupo=(l.match(/group-title="([^"]+)"/)||[])[1]||"Outros";
     }else if(l.startsWith("http")){
      if(!grupos[atual.grupo])grupos[atual.grupo]=[];
      grupos[atual.grupo].push({nome:atual.nome,url:l.trim()});
     }
    });

    Object.keys(grupos).sort().forEach(g=>{
     const c=document.createElement("div");
     c.className="cat-item";
     c.tabIndex=0;
     c.textContent=g;
     c.onclick=()=>listar(grupos[g]);
     cats.appendChild(c);
    });
 } catch(e) { console.error(e) }
}

const categorias=["AÃ§Ã£o","Anime","AnimaÃ§Ã£o","Aventura","ClÃ¡ssicos","ComÃ©dia","Crime","DocumentÃ¡rios","Dorama","Drama","Faroeste","FicÃ§Ã£o","Musical","Nacional","Policial","Religioso","Romance","Suspense","Terror","Adulto"];

async function filmes(){loadJSON("filmes.json")}
async function series(){loadJSON("series.json")}
async function filmesKids(){loadJSON("kids_filmes.json",true)}
async function seriesKids(){loadJSON("kids_series.json",true)}

async function loadJSON(file,kids){
 limpar();
 try {
    const j=await fetch(`https://raw.githubusercontent.com/paixaoflix-mobile/paixaoflix-mobile/main/data/${file}`).then(r=>r.json());
    j.sort((a,b)=>a.titulo.localeCompare(b.titulo));
