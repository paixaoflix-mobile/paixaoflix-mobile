<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Paix√£oFlix TV ‚Äî v1.7.7</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
<link href="https://vjs.zencdn.net/8.10.0/video-js.css" rel="stylesheet"/>

<style>
*{box-sizing:border-box}
body{margin:0;background:#000;color:#fff;font-family:Poppins;overflow:hidden}
::-webkit-scrollbar{display:none}

.app{display:flex;height:100vh}

/* MENU */
.left{width:230px;background:#0b0b0b;display:flex;flex-direction:column}
.logo img{width:160px;margin:10px auto;display:block}
.menu{padding:10px}
.menu button{
 width:100%;padding:12px;margin-bottom:8px;
 background:#1a1a1a;border:none;border-radius:8px;color:#fff
}
.menu button:focus{outline:3px solid #e50914}

/* CATEGORIAS */
.categories{
 width:240px;background:#111;padding:8px;overflow-y:auto
}
.cat-item{padding:10px;cursor:pointer}
.cat-item:focus{background:#1c1c1c;border-left:4px solid #e50914}

/* MAIN */
.main{flex:1;overflow-y:auto}
.grid{
 display:grid;
 grid-template-columns:repeat(auto-fill,minmax(180px,1fr));
 gap:16px;padding:16px
}
.card{
 background:#111;border-radius:10px;overflow:hidden;cursor:pointer
}
.card img{width:100%}
.card:focus{outline:4px solid #e50914}
.info{padding:8px;font-size:13px}

/* PLAYER */
.player-box{position:fixed;inset:0;display:none;background:#000;z-index:10}
.player-box.active{display:block}
.exit-btn{
 position:fixed;top:10px;left:10px;
 background:#e50914;color:#fff;
 border:none;padding:10px;border-radius:8px;
 display:none;z-index:20
}
.exit-btn.active{display:block}
</style>
</head>

<body>
<div class="app">

<aside class="left">
 <div class="logo">
  <img src="https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/logoof512.png">
 </div>
 <div class="menu" id="menu">
  <button onclick="tv()">üì° TV ao Vivo</button>
  <button onclick="tvKids()">üßí TV Kids</button>
  <button onclick="filmes()">üé¨ Filmes</button>
  <button onclick="series()">üì∫ S√©ries</button>
  <button onclick="filmesKids()">üéà Filmes Kids</button>
  <button onclick="seriesKids()">üß∏ S√©ries Kids</button>
 </div>
</aside>

<aside class="categories" id="cats"></aside>
<main class="main" id="main"></main>

<button class="exit-btn" id="exitBtn" onclick="sair()">‚¨Ö Voltar</button>
<div class="player-box" id="playerBox">
 <video id="player" class="video-js" controls></video>
</div>

</div>

<script src="https://vjs.zencdn.net/8.10.0/video.min.js"></script>
<script>
const player=videojs("player",{fluid:true});
const box=document.getElementById("playerBox");
const exitBtn=document.getElementById("exitBtn");
const main=document.getElementById("main");
const cats=document.getElementById("cats");

let focusGrid=[];
let cols=1;

/* ===================== FOCO REAL POR GRID ===================== */
function buildFocus(){
 focusGrid=[...document.querySelectorAll(".menu button,.cat-item,.card")];
 const grid=document.querySelector(".grid");
 if(grid){
  cols=getComputedStyle(grid).gridTemplateColumns.split(" ").length;
 }
}

function move(dx,dy){
 const el=document.activeElement;
 const idx=focusGrid.indexOf(el);
 if(idx<0) return;

 let target=idx;
 if(el.classList.contains("card")){
  const row=Math.floor(idx/cols);
  const col=idx%cols;
  const newRow=row+dy;
  const newCol=col+dx;
  target=newRow*cols+newCol;
 }else{
  target+=dy;
 }

 focusGrid[target]?.focus();
}

/* ===================== CONTROLE ===================== */
document.addEventListener("keydown",e=>{
 if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key)){
  e.preventDefault();
 }
 if(e.key==="ArrowUp") move(0,-1);
 if(e.key==="ArrowDown") move(0,1);
 if(e.key==="ArrowLeft") move(-1,0);
 if(e.key==="ArrowRight") move(1,0);
 if(e.key==="Enter") document.activeElement.click();
 if(["Escape","Backspace"].includes(e.key)) sair();
});

/* ===================== PLAYER ===================== */
function play(url){
 box.classList.add("active");
 exitBtn.classList.add("active");
 player.src({src:url,type:url.includes("m3u8")?"application/x-mpegURL":"video/mp4"});
 player.play();
}
function sair(){
 player.pause();
 box.classList.remove("active");
 exitBtn.classList.remove("active");
 document.querySelector(".menu button")?.focus();
}

/* ===================== LISTAGENS ===================== */
function limpar(){cats.innerHTML="";main.innerHTML=""}

function listar(lista,click){
 main.innerHTML="<div class='grid'></div>";
 const g=main.querySelector(".grid");
 lista.forEach(i=>{
  const c=document.createElement("div");
  c.className="card";
  c.tabIndex=0;
  c.innerHTML=i.poster
   ? `<img src="${i.poster}"><div class="info">${i.titulo}</div>`
   : `<div class="info">${i.nome}</div>`;
  c.onclick=()=>click(i);
  g.appendChild(c);
 });
 setTimeout(()=>{buildFocus();g.firstChild?.focus()},50);
}

/* ===================== TV ===================== */
async function loadM3U(url){
 const t=await fetch(url).then(r=>r.text());
 const lines=t.split("\n");
 const list=[];
 let nome="";
 lines.forEach(l=>{
  if(l.startsWith("#EXTINF")) nome=l.split(",")[1];
  if(l.startsWith("http")) list.push({nome,url:l});
 });
 return list;
}

async function tv(){
 limpar();
 const canais=await loadM3U("https://raw.githubusercontent.com/paixaoflix-mobile/paixaoflix-mobile/main/data/canais.m3u");
 listar(canais,c=>play(c.url));
}

async function tvKids(){
 limpar();
 const canais=await loadM3U("https://raw.githubusercontent.com/paixaoflix-mobile/paixaoflix-mobile/main/data/canais_kids.m3u");
 listar(canais,c=>play(c.url));
}

/* ===================== FILMES / S√âRIES ===================== */
async function filmes(){loadJSON("filmes.json",false)}
async function series(){loadJSON("series.json",true)}
async function filmesKids(){loadJSON("kids_filmes.json",false)}
async function seriesKids(){loadJSON("kids_series.json",true)}

async function loadJSON(file,isSerie){
 limpar();
 const j=await fetch(`https://raw.githubusercontent.com/paixaoflix-mobile/paixaoflix-mobile/main/data/${file}`).then(r=>r.json());
 j.sort((a,b)=>a.titulo.localeCompare(b.titulo));
 listar(j,i=>{
  if(isSerie) abrirSerie(i);
  else play(i.url);
 });
}

/* ===================== P√ÅGINA DE EPIS√ìDIOS ===================== */
function abrirSerie(serie){
 limpar();
 main.innerHTML=`
  <h2 style="padding:16px">${serie.titulo}</h2>
  <div class="grid"></div>`;
 const g=main.querySelector(".grid");
 serie.episodios.forEach(ep=>{
  const c=document.createElement("div");
  c.className="card";
  c.tabIndex=0;
  c.innerHTML=`
   <img src="${serie.poster}">
   <div class="info">${ep.titulo}</div>`;
  c.onclick=()=>play(ep.url);
  g.appendChild(c);
 });
 setTimeout(()=>{buildFocus();g.firstChild?.focus()},50);
}

/* FOCO INICIAL */
window.onload=()=>{
 document.querySelector(".menu button")?.focus();
 buildFocus();
};
</script>
</body>
</html>
