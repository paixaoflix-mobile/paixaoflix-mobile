<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Paix√£oFlix TV ‚Äî v4.0 Final</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link href="https://vjs.zencdn.net/8.10.0/video-js.css" rel="stylesheet"/>
    
    <style>
        :root { --primary: #e50914; --bg-dark: #000000; --bg-side: #0b0b0b; --text: #ffffff; }
        
        /* ESTILO GLOBAL - FONTE POPPINS */
        * { box-sizing: border-box; outline: none; font-family: 'Poppins', sans-serif !important; }
        body { margin: 0; background: var(--bg-dark); color: var(--text); overflow: hidden; width: 100vw; height: 100vh; }
        ::-webkit-scrollbar { display: none; }

        .app-container { display: flex; height: 100vh; width: 100vw; }
        
        /* SIDEBAR CONGELADA */
        .sidebar { width: 240px; background: var(--bg-side); display: flex; flex-direction: column; padding: 20px; border-right: 1px solid #222; z-index: 100; }
        .logo img { width: 140px; display: block; margin: 0 auto 10px; }
        
        .stats-counter { font-size: 11px; text-align: center; color: var(--primary); font-weight: 600; margin-bottom: 5px; letter-spacing: 1px; }
        .date-display { font-size: 12px; text-align: center; color: #888; margin-bottom: 20px; text-transform: capitalize; }
        
        .search-box input { width: 100%; padding: 12px; border: 1px solid #333; border-radius: 8px; background: #151515; color: #fff; font-size: 14px; margin-bottom: 20px; }

        .nav-menu { flex: 1; overflow-y: auto; }
        .nav-menu button { width: 100%; padding: 14px; margin-bottom: 10px; border: none; border-radius: 8px; background: #1a1a1a; color: #fff; cursor: pointer; text-align: left; font-size: 13px; font-weight: 600; transition: 0.2s; border-left: 4px solid transparent; }
        .nav-menu button:focus { background: #333; border-left-color: var(--primary); transform: scale(1.02); }

        /* GRID OBRIGAT√ìRIO: 3 COLUNAS MOBILE / 5 DESKTOP */
        .content-area { flex: 1; overflow-y: auto; background: #000; scroll-behavior: smooth; position: relative; }
        .grid { display: grid; padding: 20px; gap: 15px; grid-template-columns: repeat(5, 1fr); }
        
        @media (max-width: 768px) {
            .grid { grid-template-columns: repeat(3, 1fr) !important; padding: 10px; gap: 8px; }
            .sidebar { width: 180px; padding: 10px; }
            .logo img { width: 100px; }
        }

        .card { background: #111; border-radius: 8px; overflow: hidden; border: 3px solid transparent; cursor: pointer; transition: 0.2s; position: relative; }
        .card img { width: 100%; aspect-ratio: 2/3; object-fit: cover; display: block; }
        .card:focus { border-color: var(--primary); transform: scale(1.05); z-index: 10; }
        .card-title { padding: 8px; font-size: 11px; text-align: center; font-weight: 400; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* PLAYER SEM FAIXAS PRETAS (ORDEM DIRETA) */
        #player-overlay { position: fixed; inset: 0; background: #000; z-index: 9999; display: none; }
        .video-js { width: 100% !important; height: 100% !important; }
        .vjs-tech { object-fit: fill !important; } /* Preenchimento Total */
        
        .player-controls { position: absolute; top: 30px; left: 30px; z-index: 10000; opacity: 0; transition: 0.5s; }
        #player-overlay:hover .player-controls, .player-controls.show { opacity: 1; }
        .btn-back { padding: 12px 25px; background: var(--primary); color: #fff; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.5); }
    </style>
</head>
<body>

<div class="app-container">
    <aside class="sidebar">
        <div class="logo"><img src="https://raw.githubusercontent.com/paixaoflix-mobile/paixaoflix-mobile/refs/heads/main/logoof512.png"></div>
        <div class="stats-counter" id="stats-counter">SINCRONIZANDO...</div>
        <div id="date-now" class="date-display"></div>
        
        <div class="search-box">
            <input type="text" id="search-input" placeholder="Busca Global em tudo...">
        </div>

        <nav class="nav-menu">
            <button onclick="loadLiveTV('canais.m3u')">üì° TV AO VIVO</button>
            <button onclick="loadSection('kids_tv')">üßí TV KIDS</button>
            <button onclick="loadSection('filmes')">üé¨ FILMES</button>
            <button onclick="loadSection('series')">üì∫ S√âRIES</button>
            <button onclick="loadSection('kids_f')">üéà FILMES KIDS</button>
            <button onclick="loadSection('kids_s')">üß∏ S√âRIES KIDS</button>
        </nav>
    </aside>

    <main class="content-area" id="main-scroller">
        <div class="grid" id="main-grid"></div>
    </main>
</div>

<div id="player-overlay">
    <div class="player-controls" id="p-ctrls">
        <button class="btn-back" onclick="closePlayer()">‚¨Ö SAIR DA EXIBI√á√ÉO</button>
    </div>
    <video id="main-player" class="video-js vjs-big-play-centered"></video>
</div>

<script src="https://vjs.zencdn.net/8.10.0/video.min.js"></script>

<script>
    const API_BASE = "https://raw.githubusercontent.com/paixaoflix-mobile/paixaoflix-mobile/main/data/";
    let cache = { filmes: [], series: [], kids_f: [], kids_s: [], kids_tv: [] };
    let player = videojs('main-player', { controls: true, fluid: false, autoplay: false });
    let ctrlTimer;

    window.onload = async () => {
        updateClock();
        await syncData();
        setupRemote();
        setupSearch();
        // Come√ßa com filmes para n√£o ficar vazio
        loadSection('filmes');
        setInterval(updateClock, 60000);
    };

    function updateClock() {
        const n = new Date();
        const dias = ['domingo','segunda-feira','ter√ßa-feira','quarta-feira','quinta-feira','sexta-feira','s√°bado'];
        document.getElementById('date-now').textContent = `${dias[n.getDay()]}, ${n.getDate()}/${n.getMonth()+1}`;
    }

    async function syncData() {
        const map = [
            { k: 'filmes', f: 'filmes.json' },
            { k: 'series', f: 'series.json' },
            { k: 'kids_f', f: 'kids_filmes.json' },
            { k: 'kids_s', f: 'kids_series.json' },
            { k: 'kids_tv', f: 'kids_tv.json' }
        ];

        let total = 0;
        for(let item of map) {
            try {
                const r = await fetch(API_BASE + item.f);
                if(r.ok) {
                    const d = await r.json();
                    cache[item.k] = d.sort((a,b) => (a.titulo || a.nome).localeCompare(b.titulo || b.nome));
                    total += d.length;
                }
            } catch(e) { console.error("Erro no arquivo: " + item.f); }
        }
        document.getElementById('stats-counter').textContent = `${total} T√çTULOS ONLINE`;
    }

    function loadSection(key) {
        renderGrid(cache[key], key === 'kids_tv' ? 'tv' : 'vod');
    }

    function renderGrid(data, mode) {
        const container = document.getElementById('main-grid');
        container.innerHTML = '';
        if(!data || data.length === 0) {
            container.innerHTML = '<p style="grid-column:1/-1; text-align:center;">Nenhum conte√∫do encontrado.</p>';
            return;
        }

        data.forEach(item => {
            const div = document.createElement('div');
            div.className = 'card';
            div.tabIndex = 0;
            const title = item.titulo || item.nome;
            div.innerHTML = `
                <img src="${item.poster || item.logo}" loading="lazy">
                <div class="card-title">${title}</div>
            `;
            div.onclick = () => openPlayer(item.url, title);
            container.appendChild(div);
        });
        document.getElementById('main-scroller').scrollTop = 0;
    }

    function openPlayer(url, title) {
        if(!url) return;
        document.getElementById('player-overlay').style.display = 'block';
        player.src({ src: url, type: url.includes('m3u8') ? 'application/x-mpegURL' : 'video/mp4' });
        
        const saved = localStorage.getItem('save_' + title);
        if(saved) player.currentTime(parseFloat(saved));
        
        player.play();
        player.on('timeupdate', () => {
            if(player.currentTime() > 10) localStorage.setItem('save_' + title, player.currentTime());
        });
        showControls();
    }

    function closePlayer() {
        player.pause();
        document.getElementById('player-overlay').style.display = 'none';
    }

    function showControls() {
        const c = document.getElementById('p-ctrls');
        c.classList.add('show');
        clearTimeout(ctrlTimer);
        ctrlTimer = setTimeout(() => c.classList.remove('show'), 4000);
    }

    function setupSearch() {
        document.getElementById('search-input').oninput = (e) => {
            const val = e.target.value.toLowerCase();
            if(val.length < 2) return;
            const all = [...cache.filmes, ...cache.series, ...cache.kids_f, ...cache.kids_s];
            const filtered = all.filter(i => (i.titulo || i.nome || "").toLowerCase().includes(val));
            renderGrid(filtered, 'vod');
        };
    }

    function setupRemote() {
        document.addEventListener('keydown', (e) => {
            const isPlayer = document.getElementById('player-overlay').style.display === 'block';
            
            if(e.key === 'Enter') document.activeElement.click();
            if(e.key === 'Backspace' || e.key === 'Escape') {
                if(isPlayer) closePlayer();
            }

            // CH+ / CH- (PageUp / PageDown)
            if(e.key === 'PageUp') document.getElementById('main-scroller').scrollBy(0, -500);
            if(e.key === 'PageDown') document.getElementById('main-scroller').scrollBy(0, 500);

            // Comandos dentro do Player
            if(isPlayer) {
                showControls();
                if(e.key === 'ArrowRight') player.currentTime(player.currentTime() + 10);
                if(e.key === 'ArrowLeft') player.currentTime(player.currentTime() - 10);
            }
        });
    }

    async function loadLiveTV(file) {
        const res = await fetch(API_BASE + file);
        const text = await res.text();
        const channels = [];
        const lines = text.split('\n');
        lines.forEach((line, i) => {
            if(line.startsWith('#EXTINF')){
                const nome = line.split(',')[1]?.trim();
                const logo = line.match(/tvg-logo="([^"]+)"/)?.[1];
                const url = lines[i+1]?.trim();
                if(url) channels.push({nome, logo, url});
            }
        });
        renderGrid(channels, 'tv');
    }
</script>
</body>
</html>
