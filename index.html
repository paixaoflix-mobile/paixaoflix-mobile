<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>PaixÃ£oFlix TV â€” v1.8.0</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<style>
/* BLOQUEIO DE ORIENTAÃ‡ÃƒO */
@media (orientation: portrait) {
 body::before{
  content:"ðŸ”„ Gire o dispositivo para modo paisagem";
  position:fixed;inset:0;
  background:#000;color:#fff;
  display:flex;align-items:center;justify-content:center;
  font-size:22px;z-index:9999;text-align:center
 }
}

*{box-sizing:border-box}
body{
 margin:0;background:#000;color:#fff;
 font-family:'Poppins',sans-serif;
 overflow:hidden;
}
::-webkit-scrollbar{display:none}

.app{display:flex;height:100vh}

/* MENU LATERAL */
.left{
 width:230px;background:#0b0b0b;
 box-shadow:2px 0 6px rgba(0,0,0,.35);
 display:flex;flex-direction:column;
 z-index: 10;
}
.logo img{
 width:clamp(100px,12vh,200px);
 margin:10px auto;display:block
}
.datetime{text-align:center;font-size:13px;opacity:.8; margin-bottom: 10px;}

/* BUSCA */
.search{padding:10px}
.search input{
 width:100%;padding:12px;
 border-radius:8px;border:none;
 background:#1a1a1a;color:#fff;
 outline: none;
 font-size: 14px;
}

/* MENU BOTÃ•ES */
.menu{padding:10px; overflow-y:auto; flex:1}
.menu button{
 width:100%;margin-bottom:8px;padding:12px;
 background:linear-gradient(180deg,#2a2a2a,#141414);
 border:none;border-radius:10px;color:#fff;
 cursor:pointer; text-align: left;
 transition: all 0.2s;
}

/* CATEGORIAS */
.categories{
 background:#111; padding:8px;
 min-width:max-content; max-width:260px;
 overflow-y:auto; border-right: 1px solid #222;
}
.cat-item{
 padding:12px 15px; cursor:pointer;
 white-space:nowrap; border-radius: 5px;
 margin-bottom: 4px; outline: none;
}

/* MAIN CONTENT */
.main{
 flex:1; overflow-y:auto;
 background:radial-gradient(circle,#111,#000);
 scroll-behavior: smooth;
}

/* GRID DE FILMES */
.grid{
 display:grid; gap:16px; padding:16px;
 grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
}

.card{
 background:#111; border-radius:10px;
 overflow:hidden; cursor:pointer;
 transition: transform 0.2s, box-shadow 0.2s;
 outline: none;
}
.card img{width:100%; aspect-ratio: 2/3; object-fit: cover; display:block}
.card .info{padding:8px; font-size:13px}
.card .info strong { display: block; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

/* FOCO VISUAL (ESSENCIAL PARA SMART TV) */
:focus {
    outline: 4px solid #e50914 !important;
    transform: scale(1.03);
    z-index: 5;
    background: #e50914 !important;
}

/* PLAYER */
.player-box{
 position:fixed;inset:0;
 background:#000;display:none;z-index:20
}
.player-box.active{display:block}
.video-js{width:100%;height:100%}

.exit-btn{
 position:fixed;top:15px;left:15px;
 z-index:30;background:#e50914;
 border:none;border-radius:8px;
 color:#fff;padding:12px 18px;
 display:none; font-weight: bold;
}
.exit-btn.active{display:block}
</style>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
<link href="https://vjs.zencdn.net/8.10.0/video-js.css" rel="stylesheet"/>
</head>

<body>
<div class="app">

<aside class="left">
 <div class="logo">
  <img src="https://raw.githubusercontent.com/VisorFinances/lista-paixaoflix/refs/heads/main/logoof512.png">
 </div>
 <div class="datetime" id="datetime">Carregando...</div>

 <div class="search">
  <input id="search" placeholder="Buscar..." tabindex="0">
 </div>

 <div class="menu">
  <button tabindex="0" onclick="tv()">ðŸ“¡ TV ao Vivo</button>
  <button tabindex="0" onclick="filmes()">ðŸŽ¬ Filmes</button>
  <button tabindex="0" onclick="series()">ðŸ“º SÃ©ries</button>
  <button tabindex="0" onclick="tvKids()">ðŸ§’ TV Kids</button>
  <button tabindex="0" onclick="filmesKids()">ðŸŽˆ Filmes Kids</button>
  <button tabindex="0" onclick="seriesKids()">ðŸ§¸ SÃ©ries Kids</button>
 </div>
</aside>

<aside class="categories" id="cats"></aside>
<main class="main" id="main"></main>

<button class="exit-btn" id="exitBtn" onclick="sair()" tabindex="0">â¬… VOLTAR</button>

<div class="player-box" id="playerBox">
 <video id="player" class="video-js vjs-default-skin" controls preload="auto"></video>
</div>

</div>

<script src="https://vjs.zencdn.net/8.10.0/video.min.js"></script>
<script>
const player = videojs("player");
const box = document.getElementById("playerBox");
const exitBtn = document.getElementById("exitBtn");
const main = document.getElementById("main");
const cats = document.getElementById("cats");

/* ATUALIZA RELÃ“GIO */
function updateTime() {
    const d = new Date();
    document.getElementById("datetime").textContent = d.toLocaleDateString("pt-BR", {weekday:"short"}).toUpperCase() + " | " + d.toLocaleTimeString("pt-BR", {hour:"2-digit", minute:"2-digit"});
}
setInterval(updateTime, 1000);
updateTime();

function limpar() { cats.innerHTML = ""; main.innerHTML = ""; }

/* PLAYER LOGIC */
function play(url) {
    box.classList.add("active");
    exitBtn.classList.add("active");
    player.src({ src: url, type: url.includes("m3u8") ? "application/x-mpegURL" : "video/mp4" });
    player.play();
    setTimeout(() => exitBtn.focus(), 500);
}

function sair() {
    player.pause();
    box.classList.remove("active");
    exitBtn.classList.remove("active");
    const lastFocused = document.querySelector('.card') || document.querySelector('button');
    if(lastFocused) lastFocused.focus();
}

/* NAVEGAÃ‡ÃƒO ESPACIAL (MOTOR GEOMÃ‰TRICO) */
document.addEventListener("keydown", e => {
    const directions = ["ArrowUp", "ArrowDown", "ArrowLeft", "ArrowRight"];
    
    // Se estiver no player
    if (box.classList.contains('active')) {
        if (["Escape", "Backspace"].includes(e.key)) { sair(); e.preventDefault(); }
        return;
    }

    if (e.key === "Enter") {
        if(document.activeElement) document.activeElement.click();
        return;
    }

    if (!directions.includes(e.key)) return;
    
    e.preventDefault();

    const focusables = Array.from(document.querySelectorAll('button, .cat-item, .card, input, [tabindex="0"]'))
                            .filter(el => el.offsetParent !== null);
    
    let current = document.activeElement;

    // Se o foco se perder, resgata para o primeiro botÃ£o
    if (!current || current === document.body) {
        if (focusables.length > 0) focusables[0].focus();
        return;
    }

    const currentRect = current.getBoundingClientRect();
    let next = null;
    let minDistance = Infinity;

    focusables.forEach(target => {
        if (target === current) return;
        const targetRect = target.getBoundingClientRect();

        const curCenter = { x: currentRect.left + currentRect.width / 2, y: currentRect.top + currentRect.height / 2 };
        const tarCenter = { x: targetRect.left + targetRect.width / 2, y: targetRect.top + targetRect.height / 2 };

        let isDirection = false;

        // Margem de erro de 5px para alinhar elementos levemente desalinhados
        if (e.key === "ArrowUp" && targetRect.bottom <= (currentRect.top + 5)) isDirection = true;
        if (e.key === "ArrowDown" && targetRect.top >= (currentRect.bottom - 5)) isDirection = true;
        if (e.key === "ArrowLeft" && targetRect.right <= (currentRect.left + 5)) isDirection = true;
        if (e.key === "ArrowRight" && targetRect.left >= (currentRect.right - 5)) isDirection = true;

        if (isDirection) {
            const distance = Math.sqrt(Math.pow(tarCenter.x - curCenter.x, 2) + Math.pow(tarCenter.y - curCenter.y, 2));
            if (distance < minDistance) {
                minDistance = distance;
                next = target;
            }
        }
    });

    if (next) {
        next.focus();
        next.scrollIntoView({ behavior: "smooth", block: "center", inline: "nearest" });
    }
});

/* CARREGAMENTO DE DADOS */
async function tv() {
    limpar();
    const res = await fetch("https://raw.githubusercontent.com/paixaoflix-mobile/paixaoflix-mobile/main/data/canais.m3u");
    const txt = await res.text();
    const linhas = txt.split("\n");
    const grupos = {};
    let atual = {};

    linhas.forEach(l => {
        if (l.startsWith("#EXTINF")) {
            atual.nome = l.split(",")[1];
            atual.grupo = (l.match(/group-title="([^"]+)"/) || [])[1] || "Outros";
        } else if (l.startsWith("http")) {
            if (!grupos[atual.grupo]) grupos[atual.grupo] = [];
            grupos[atual.grupo].push({ nome: atual.nome, url: l.trim() });
        }
    });

    Object.keys(grupos).sort().forEach(g => {
        const c = document.createElement("div");
        c.className = "cat-item"; c.tabIndex = 0;
        c.textContent = g;
        c.onclick = () => listar(grupos[g]);
        cats.appendChild(c);
    });
    // Foca na primeira categoria automaticamente
    setTimeout(() => cats.querySelector('.cat-item')?.focus(), 200);
}

const categorias = ["AÃ§Ã£o", "Anime", "AnimaÃ§Ã£o", "Aventura", "ClÃ¡ssicos", "ComÃ©dia", "Crime", "DocumentÃ¡rios", "Dorama", "Drama", "Faroeste", "FicÃ§Ã£o", "Musical", "Nacional", "Policial", "Religioso", "Romance", "Suspense", "Terror", "Adulto"];

async function filmes() { loadJSON("filmes.json") }
async function series() { loadJSON("series.
